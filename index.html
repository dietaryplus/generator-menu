
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Men√∫s Redox - Dietaryplus</title>
    <meta name="description" content="Crea planes nutricionales personalizados basados en la Filosof√≠a Redox de Dietaryplus">
    <meta name="keywords" content="nutrici√≥n, redox, dietaryplus, men√∫s, salud, estre√±imiento, SOP">
    <meta name="author" content="Dietaryplus">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå±</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .form-section {
            display: block;
        }
        
        .preview-section {
            display: none;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .radio-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .radio-option:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .radio-option input[type="radio"] {
    margin-right: 10px;
    transform: scale(1.2);
}
        
        .radio-option input[type="radio"]:checked + .option-content {
            color: #2980b9;
            font-weight: 600;
        }
        
        .radio-option input[type="radio"]:checked ~ .option-icon {
            background: #3498db;
            color: white;
        }
        
        .option-content h3 {
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .option-content p {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .option-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            transition: all 0.3s;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .checkbox-option {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .checkbox-option:hover {
            background: #e3f2fd;
            border-color: #3498db;
        }
        
        .checkbox-option input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .checkbox-option input[type="checkbox"]:checked + span {
            color: #2980b9;
            font-weight: 600;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-right: 10px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .actions {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .preview-menu {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .preview-menu h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .menu-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .menu-table th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .menu-table td {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.85em;
            vertical-align: top;
        }
        
        .menu-table .meal-label {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            width: 120px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            text-align: center;
        }
        
        .footer {
            background: #f8f9fa;
            color: #6c757d;
            text-align: center;
            padding: 20px;
            border-top: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        
        .duration-selector {
            display: none;
        }
        
        .phase-card {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .phase-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .phase-number {
            background: #3498db;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .phase-title {
            flex: 1;
        }
        
        .phase-title h4 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.2em;
        }
        
        .phase-title p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .week-menu {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .week-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .radio-group {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Generador de Men√∫s Redox</h1>
            <p>Crea planes nutricionales personalizados basados en la Filosof√≠a Redox</p>
        </div>
        
        <div class="main-content">
            <!-- FORMULARIO -->
            <div class="form-section" id="formSection">
                <div class="form-group">
                    <label for="patientName">üë§ Nombre del Paciente</label>
                    <input type="text" id="patientName" placeholder="Ej: Mar√≠a Garc√≠a" required>
                </div>
                
                <div class="form-group">
                    <label>üéØ Condici√≥n Principal (la m√°s urgente a tratar)</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="constipation" name="condition" value="estre√±imiento">
                            <div class="option-content">
                                <h3>Estre√±imiento Severo</h3>
                                <p>0-2 deposiciones/semana, distensi√≥n, dolor abdominal</p>
                            </div>
                            <div class="option-icon">üíß</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="pcos" name="condition" value="sop">
                            <div class="option-content">
                                <h3>SOP (S√≠ndrome Ovario Poliqu√≠stico)</h3>
                                <p>Resistencia insul√≠nica, hiperandrogenismo, disbiosis</p>
                            </div>
                            <div class="option-icon">‚öñÔ∏è</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="weightloss" name="condition" value="perdida-peso">
                            <div class="option-content">
                                <h3>P√©rdida de Peso</h3>
                                <p>Reducci√≥n de volumen sin efecto rebote</p>
                            </div>
                            <div class="option-icon">üìâ</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="inflammation" name="condition" value="inflamacion">
                            <div class="option-content">
                                <h3>Inflamaci√≥n Sist√©mica</h3>
                                <p>Artritis, fatiga, dolor cr√≥nico, marcadores elevados</p>
                            </div>
                            <div class="option-icon">üî•</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>üìÖ Tipo de Plan</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="plan-semanal" name="planType" value="semanal">
                            <div class="option-content">
                                <h3>Plan Semanal</h3>
                                <p>1 men√∫ para empezar inmediatamente</p>
                            </div>
                            <div class="option-icon">üìã</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="plan-evolutivo" name="planType" value="evolutivo">
                            <div class="option-content">
                                <h3>Plan Evolutivo Estrat√©gico</h3>
                                <p>M√∫ltiples men√∫s con visi√≥n a largo plazo</p>
                            </div>
                            <div class="option-icon">üîÑ</div>
                        </div>
                    </div>
                </div>

                <div class="form-group duration-selector" id="durationSelector">
                    <label>‚è±Ô∏è Duraci√≥n del Tratamiento</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="duration-4" name="duration" value="4">
                            <div class="option-content">
                                <h3>4 Semanas - Choque Intensivo</h3>
                                <p>Para problemas agudos. M√°xima intensidad, resultados r√°pidos.</p>
                            </div>
                            <div class="option-icon">‚ö°</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="duration-8" name="duration" value="8">
                            <div class="option-content">
                                <h3>8 Semanas - Tratamiento Completo</h3>
                                <p>Choque + estabilizaci√≥n + optimizaci√≥n. M√°s popular.</p>
                            </div>
                            <div class="option-icon">üéØ</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="duration-12" name="duration" value="12">
                            <div class="option-content">
                                <h3>12 Semanas - Transformaci√≥n Profunda</h3>
                                <p>Para casos complejos. Abordaje integral y sostenible.</p>
                            </div>
                            <div class="option-icon">üåü</div>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="duration-16" name="duration" value="16">
                            <div class="option-content">
                                <h3>16 Semanas - Regeneraci√≥n Total</h3>
                                <p>Para casos severos. Nueva versi√≥n de ti mismo.</p>
                            </div>
                            <div class="option-icon">üöÄ</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‚ûï Condiciones Secundarias (que tambi√©n quiere mejorar)</label>
                    <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px;">Selecciona todas las que apliquen. El men√∫ se adaptar√° para abordar m√∫ltiples problemas.</p>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="secondary-digestive" value="problemas-digestivos">
                            <span>Problemas Digestivos</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="secondary-fatigue" value="fatiga-cronica">
                            <span>Fatiga Cr√≥nica</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="secondary-sleep" value="problemas-sue√±o">
                            <span>Problemas de Sue√±o</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="secondary-anxiety" value="ansiedad-estres">
                            <span>Ansiedad / Estr√©s</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="secondary-skin" value="problemas-piel">
                            <span>Problemas de Piel</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="secondary-hair" value="caida-cabello">
                            <span>Ca√≠da del Cabello</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‚öïÔ∏è Terapias F√≠sicas Redox</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="infrared" value="infrarrojo">
                            <span>Terapia Infrarrojo</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="thermogenesis" value="termogenesis">
                            <span>Termog√©nesis</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="vagal" value="vagal">
                            <span>Estimulaci√≥n Vagal</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>üö´ Exclusiones Alimentarias</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="gluten-free" value="sin-gluten">
                            <span>Sin Gluten</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="dairy-free" value="sin-lacteos">
                            <span>Sin L√°cteos</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="nuts-free" value="sin-frutos-secos">
                            <span>Sin Frutos Secos</span>
                        </div>
                        
                        <div class="checkbox-option">
                            <input type="checkbox" id="eggs-free" value="sin-huevos">
                            <span>Sin Huevos</span>
                        </div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn" onclick="generateMenu()">
                        üöÄ Generar Plan Redox
                    </button>
                </div>
            </div>
            
            <!-- LOADING -->
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <h3>Generando tu plan personalizado...</h3>
                <p>Aplicando principios de la Filosof√≠a Redox</p>
            </div>
            
            <!-- PREVIEW -->
            <div class="preview-section" id="previewSection">
                <div class="success-message">
                    ‚úÖ <strong>Plan generado exitosamente!</strong> Revisa el contenido antes de descargar.
                </div>
                
                <div class="preview-menu" id="menuPreview">
                    <!-- El men√∫ se generar√° aqu√≠ din√°micamente -->
                </div>
                
                <div class="actions">
                    <button class="btn btn-secondary" onclick="goBack()">
                        ‚Üê Volver al Formulario
                    </button>
                    <button class="btn" onclick="downloadPDF()">
                        üìÑ Descargar PDF
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>¬© 2024 Dietaryplus - Generador de Men√∫s Redox | <strong>Versi√≥n 2.0 Completa</strong></p>
        </div>
    </div>

    <script>
        // Base de datos Redox expandida
        const baseDatosRedox = {
            estre√±imiento: {
                nombre: "Protocolo Anti-Estre√±imiento",
                protocolo: "Hidrataci√≥n intensiva + MCT + Infrarrojo + Estimulaci√≥n vagal",
                horarios: ["7:00", "7:30", "10:30", "13:30", "16:30", "20:00"],
                momentos: ["DESPERTAR", "DESAYUNO", "ALMUERZO", "COMIDA", "MERIENDA", "CENA"],
                alimentos: {
                    despertar: [
                        "500ml agua tibia + lim√≥n + sal marina + 2 cda MCT",
                        "Protocolo hidrataci√≥n base + aceites espec√≠ficos",
                        "Activaci√≥n matinal + estimulaci√≥n biliar"
                    ],
                    desayunos: [
                        "Batido pl√°tano + nueces + cacao + leche coco + aguacate + mantequilla pasto",
                        "Tortilla 3 huevos pastoreo + espinacas + aguacate + mantequilla pasto generosa",
                        "Revuelto 2 huevos + champi√±ones + aguacate + semillas calabaza + mantequilla",
                        "Batido verde: espinacas + aguacate + leche coco + huevos pochados + mantequilla"
                    ],
                    almuerzos: [
                        "6-8 ciruelas pasas remojadas overnight + 500ml agua pura",
                        "Compota manzana casera + canela + 500ml agua",
                        "Pl√°tano maduro + nueces crudas + hidrataci√≥n abundante",
                        "Papaya fresca (enzimas digestivas) + hidrataci√≥n constante"
                    ],
                    comidas: [
                        "Ensalada variada + AOVE + Pur√© coco-zanahoria-cebolla + Salm√≥n plancha + Chocolate 85%",
                        "Ensalada + chucrut casero + Pur√© calabac√≠n-coco + Caballa horno + Chocolate + ciruelas",
                        "Ensalada + kimchi + Pur√© calabaza-coco + Ternera plancha + Chocolate + frutos rojos",
                        "Ensalada completa + Pur√© zanahoria-coco + Sardinas frescas + Chocolate + ciruelas"
                    ],
                    meriendas: [
                        "K√©fir cabra 200ml + 1 cda aceite coco + almendras crudas 20g",
                        "K√©fir + aceite coco + nueces 20g",
                        "K√©fir + aceite coco + mix frutos secos naturales"
                    ],
                    cenas: [
                        "Caldo huesos + tu√©tano + Boniato horno + mantequilla + Pechuga pavo + Infusi√≥n sen 22h",
                        "Caldo graso + Calabaza asada + mantequilla + Merluza vapor + Infusi√≥n + aceite coco 22h",
                        "Caldo nutritivo + Boniato + mantequilla + Pollo ecol√≥gico + Infusi√≥n sen + coco 22h"
                    ]
                }
            },
            sop: {
                nombre: "Protocolo SOP - Regulaci√≥n Hormonal",
                protocolo: "Anti-inflamatorio + Prote√≠na alta + Regulaci√≥n insul√≠nica + Modulaci√≥n andr√≥genos",
                horarios: ["7:00", "11:00", "15:00", "20:00"],
                momentos: ["DESPERTAR", "DESAYUNO", "COMIDA", "CENA"],
                alimentos: {
                    despertar: [
                        "Agua tibia + lim√≥n + sal marina + electrolitos",
                        "Base hormonal: hidrataci√≥n + minerales",
                        "Activaci√≥n SOP: agua + citrato natural"
                    ],
                    desayunos: [
                        "Huevos pastoreo (2-3) + aguacate grande + mantequilla pasto + aceite oliva",
                        "Salm√≥n ahumado + aguacate + huevos + semillas calabaza + AOVE",
                        "Tortilla proteica + vegetales + grasas antiinflamatorias + mantequilla",
                        "Revuelto alto en prote√≠na + aguacate + aceite coco + frutos secos"
                    ],
                    comidas: [
                        "Ensalada abundante + Cruc√≠feras al vapor + Pescado graso + AOVE abundante",
                        "Ensalada + Fermentados naturales + Carne pastoreo + Grasas calidad",
                        "Ensalada + Vegetales anti-androg√©nicos + Prote√≠na alta + Aceite oliva",
                        "Ensalada + Probi√≥ticos naturales + Prote√≠na completa + AOVE"
                    ],
                    cenas: [
                        "Prote√≠na ligera + Verduras vapor + AOVE + Infusi√≥n relajante",
                        "Pescado blanco + Ensalada + Aguacate + Infusi√≥n hormonal",
                        "Caldo huesos + Verduras + Prote√≠na ligera + Infusi√≥n equilibrante"
                    ]
                }
            },
            'perdida-peso': {
                nombre: "Protocolo P√©rdida de Peso",
                protocolo: "Ayuno intermitente + Termog√©nesis + Cetosis nutricional + Activaci√≥n metab√≥lica",
                horarios: ["7:00", "12:00", "18:00"],
                momentos: ["DESPERTAR", "COMIDA", "CENA"],
                alimentos: {
                    despertar: [
                        "Agua + lim√≥n + sal + MCT (termog√©nico)",
                        "Caf√© + aceite coco + mantequilla (cetog√©nico)",
                        "T√© verde + aceite MCT (lipol√≠tico)"
                    ],
                    comidas: [
                        "Ensalada + Prote√≠na alta + Grasas termog√©nicas + Vegetales",
                        "Verduras + Pescado + AOVE + Aguacate + Frutos secos",
                        "Prote√≠na completa + Vegetales + Grasas espec√≠ficas + Especias"
                    ],
                    cenas: [
                        "Prote√≠na ligera + Verduras + Grasas + Infusi√≥n",
                        "Pescado + Ensalada + Aceite oliva + T√©",
                        "Caldo + Vegetales + Prote√≠na + Hierbas"
                    ]
                }
            },
            inflamacion: {
                nombre: "Protocolo Anti-Inflamatorio",
                protocolo: "Modulaci√≥n inmune + Omega-3 + Antioxidantes + Eliminaci√≥n pro-inflamatorios",
                horarios: ["7:00", "8:00", "13:00", "16:00", "20:00"],
                momentos: ["DESPERTAR", "DESAYUNO", "COMIDA", "MERIENDA", "CENA"],
                alimentos: {
                    despertar: [
                        "Agua + lim√≥n + c√∫rcuma + jengibre",
                        "Hidrataci√≥n + especias anti-inflamatorias",
                        "Base alcalina + moduladores naturales"
                    ],
                    desayunos: [
                        "Batido antioxidante + omega-3 + frutos rojos",
                        "Huevos + aguacate + c√∫rcuma + aceite oliva",
                        "Smoothie verde + semillas + grasas anti-inflamatorias"
                    ],
                    comidas: [
                        "Ensalada + Pescado azul + AOVE + Vegetales colores",
                        "Verduras + Salm√≥n + Especias + Frutos secos",
                        "Cruc√≠feras + Prote√≠na + C√∫rcuma + Jengibre + AOVE"
                    ],
                    meriendas: [
                        "Frutos rojos + nueces + t√© verde",
                        "Chocolate 85% + almendras + infusi√≥n",
                        "Aguacate + semillas + especias"
                    ],
                    cenas: [
                        "Caldo huesos + vegetales + c√∫rcuma + prote√≠na ligera",
                        "Pescado + ensalada + jengibre + aceite oliva",
                        "Verduras + prote√≠na + especias + infusi√≥n anti-inflamatoria"
                    ]
                }
            }
        };

        let menuGenerado = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('constipation').checked = true;
            document.getElementById('plan-semanal').checked = true;
            document.getElementById('infrared').checked = true;
            
            // Manejar tipo de plan
            document.querySelectorAll('input[name="planType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const durationSelector = document.getElementById('durationSelector');
                    if (this.value === 'evolutivo') {
                        durationSelector.style.display = 'block';
                        document.getElementById('duration-8').checked = true;
                    } else {
                        durationSelector.style.display = 'none';
                    }
                });
            });
        });

        function generateMenu() {
            const patientName = document.getElementById('patientName').value.trim();
            const condition = document.querySelector('input[name="condition"]:checked');
            const planType = document.querySelector('input[name="planType"]:checked');
            
            if (!patientName || !condition || !planType) {
                alert('Por favor, completa todos los campos obligatorios');
                return;
            }

            if (planType.value === 'evolutivo') {
                const duration = document.querySelector('input[name="duration"]:checked');
                if (!duration) {
                    alert('Por favor, selecciona la duraci√≥n del tratamiento');
                    return;
                }
            }

            // Mostrar loading
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('loadingSection').style.display = 'block';

            setTimeout(() => {
                const data = {
                    condition: condition.value,
                    patientName: patientName,
                    planType: planType.value,
                    duration: planType.value === 'evolutivo' ? document.querySelector('input[name="duration"]:checked').value : null,
                    therapies: getSelectedItems('checkbox', ['infrarrojo', 'termogenesis', 'vagal']),
                    exclusions: getSelectedItems('checkbox', ['sin-gluten', 'sin-lacteos', 'sin-frutos-secos', 'sin-huevos']),
                    secondaryConditions: getSelectedItems('checkbox', ['problemas-digestivos', 'fatiga-cronica', 'problemas-sue√±o', 'ansiedad-estres', 'problemas-piel', 'caida-cabello'])
                };

                if (data.planType === 'semanal') {
                    menuGenerado = createWeeklyPlan(data);
                } else {
                    menuGenerado = createEvolutionaryPlan(data);
                }
                
                displayPlan(menuGenerado);
                
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('previewSection').style.display = 'block';
            }, 2500);
        }

        function getSelectedItems(type, validValues) {
            const selected = [];
            document.querySelectorAll(`input[type="${type}"]:checked`).forEach(item => {
                if (validValues.includes(item.value)) {
                    selected.push(item.value);
                }
            });
            return selected;
        }

        function createWeeklyPlan(data) {
            const conditionData = baseDatosRedox[data.condition];
            return {
                tipo: 'semanal',
                paciente: data.patientName,
                condicion: conditionData.nombre,
                protocolo: adaptProtocol(conditionData.protocolo, data),
                terapias: data.therapies,
                exclusiones: data.exclusions,
                menu: generateWeekMenu(conditionData, data)
            };
        }

        function createEvolutionaryPlan(data) {
            const conditionData = baseDatosRedox[data.condition];
            const duration = parseInt(data.duration);
            const phases = getPhaseStructure(duration);
            
            return {
                tipo: 'evolutivo',
                paciente: data.patientName,
                condicion: conditionData.nombre,
                duracion: duration,
                protocolo: adaptProtocol(conditionData.protocolo, data),
                terapias: data.therapies,
                exclusiones: data.exclusiones,
                fases: phases.map((phase, index) => ({
                    numero: index + 1,
                    nombre: phase.nombre,
                    semanas: phase.semanas,
                    objetivo: getPhaseObjective(data.condition, index + 1),
                    menus: phase.semanas.map(semana => ({
                        semana: semana,
                        menu: generateWeekMenu(conditionData, data, index + 1, semana)
                    }))
                }))
            };
        }

        function getPhaseStructure(duration) {
            const structures = {
                4: [
                    { nombre: "Choque Intensivo", semanas: [1, 2] },
                    { nombre: "Estabilizaci√≥n", semanas: [3, 4] }
                ],
                8: [
                    { nombre: "Choque", semanas: [1, 2] },
                    { nombre: "Estabilizaci√≥n", semanas: [3, 4] },
                    { nombre: "Optimizaci√≥n", semanas: [5, 6] },
                    { nombre: "Consolidaci√≥n", semanas: [7, 8] }
                ],
                12: [
                    { nombre: "Choque", semanas: [1, 2, 3] },
                    { nombre: "Estabilizaci√≥n", semanas: [4, 5, 6] },
                    { nombre: "Optimizaci√≥n", semanas: [7, 8, 9] },
                    { nombre: "Mantenimiento", semanas: [10, 11, 12] }
                ],
                16: [
                    { nombre: "Choque", semanas: [1, 2, 3, 4] },
                    { nombre: "Estabilizaci√≥n", semanas: [5, 6, 7, 8] },
                    { nombre: "Optimizaci√≥n", semanas: [9, 10, 11, 12] },
                    { nombre: "Vida Nueva", semanas: [13, 14, 15, 16] }
                ]
            };
            return structures[duration] || structures[8];
        }

        function getPhaseObjective(condition, phaseNumber) {
            const objectives = {
                estre√±imiento: [
                    "Reactivaci√≥n inmediata de motilidad intestinal mediante hidrataci√≥n + MCT + infrarrojo",
                    "Estabilizaci√≥n del tr√°nsito + introducci√≥n fermentados naturales + fibra prebi√≥tica",
                    "Optimizaci√≥n microbiota + consolidaci√≥n h√°bitos + reducci√≥n dependencias",
                    "Mantenimiento sostenible + estilo de vida Redox + autonom√≠a completa"
                ],
                sop: [
                    "Modulaci√≥n hormonal intensiva + reducci√≥n inflamaci√≥n + sensibilidad insul√≠nica",
                    "Estabilizaci√≥n ciclos + regulaci√≥n andr√≥genos + optimizaci√≥n metabolismo",
                    "Consolidaci√≥n equilibrio hormonal + mejora composici√≥n corporal",
                    "Mantenimiento natural + fertilidad √≥ptima + bienestar integral"
                ],
                'perdida-peso': [
                    "Choque metab√≥lico + activaci√≥n lipolisis + cetosis nutricional",
                    "Estabilizaci√≥n p√©rdida + mantenimiento masa muscular + metabolismo",
                    "Optimizaci√≥n composici√≥n corporal + metabolismo flexible + h√°bitos",
                    "Mantenimiento peso ideal + estilo vida saludable + prevenci√≥n rebote"
                ],
                inflamacion: [
                    "Reducci√≥n inflamaci√≥n aguda + modulaci√≥n inmune + eliminaci√≥n triggers",
                    "Estabilizaci√≥n marcadores + reparaci√≥n tisular + funci√≥n intestinal",
                    "Optimizaci√≥n sistema inmune + regeneraci√≥n completa + vitalidad",
                    "Mantenimiento anti-inflamatorio + prevenci√≥n + salud √≥ptima"
                ]
            };
            return objectives[condition] ? objectives[condition][phaseNumber - 1] : `Fase ${phaseNumber} de tratamiento integral Redox`;
        }

        function adaptProtocol(baseProtocol, data) {
            let adaptedProtocol = baseProtocol;
            
            // Agregar terapias seleccionadas
            if (data.therapies.includes('infrarrojo')) {
                adaptedProtocol += " ‚Ä¢ Infrarrojo diario 20-30min";
            }
            if (data.therapies.includes('termogenesis')) {
                adaptedProtocol += " ‚Ä¢ Termog√©nesis 3x/semana";
            }
            if (data.therapies.includes('vagal')) {
                adaptedProtocol += " ‚Ä¢ Estimulaci√≥n vagal diaria";
            }
            
            // Adaptaciones por condiciones secundarias
            data.secondaryConditions.forEach(condition => {
                switch(condition) {
                    case 'fatiga-cronica':
                        adaptedProtocol += " ‚Ä¢ Vitaminas B naturales ‚Ä¢ Hierro hemo";
                        break;
                    case 'problemas-sue√±o':
                        adaptedProtocol += " ‚Ä¢ Magnesio nocturno ‚Ä¢ Infusiones relajantes";
                        break;
                    case 'ansiedad-estres':
                        adaptedProtocol += " ‚Ä¢ Adapt√≥genos ‚Ä¢ T√©cnicas respiraci√≥n";
                        break;
                    case 'caida-cabello':
                        adaptedProtocol += " ‚Ä¢ Biotina natural ‚Ä¢ Zinc ‚Ä¢ Prote√≠nas espec√≠ficas";
                        break;
                    case 'problemas-piel':
                        adaptedProtocol += " ‚Ä¢ Omega-3 ‚Ä¢ Antioxidantes ‚Ä¢ Zinc";
                        break;
                    case 'problemas-digestivos':
                        adaptedProtocol += " ‚Ä¢ Probi√≥ticos ‚Ä¢ L-Glutamina ‚Ä¢ Enzimas";
                        break;
                }
            });
            
            return adaptedProtocol;
        }

        function generateWeekMenu(conditionData, data, phase = 1, weekNumber = 1) {
            const days = ['LUNES', 'MARTES', 'MI√âRCOLES', 'JUEVES', 'VIERNES', 'S√ÅBADO', 'DOMINGO'];
            
            return days.map((dia, dayIndex) => ({
                dia: dia,
                comidas: conditionData.momentos.map((momento, momentoIndex) => {
                    let alimento = getAlimentoForMoment(conditionData, momento, dayIndex, phase, weekNumber);
                    
                    // Aplicar exclusiones
                    alimento = applyExclusions(alimento, data.exclusions);
                    
                    // Adaptar seg√∫n condiciones secundarias
                    alimento = adaptForSecondaryConditions(alimento, data.secondaryConditions, momento);
                    
                    return {
                        momento: momento,
                        horario: conditionData.horarios[momentoIndex],
                        alimento: alimento
                    };
                })
            }));
        }

        function getAlimentoForMoment(conditionData, momento, dayIndex, phase, weekNumber) {
            const momentoKey = momento.toLowerCase();
            let alimentosArray = [];
            
            switch(momentoKey) {
                case 'despertar':
                    alimentosArray = conditionData.alimentos.despertar || [];
                    break;
                case 'desayuno':
                    alimentosArray = conditionData.alimentos.desayunos || [];
                    break;
                case 'almuerzo':
                    alimentosArray = conditionData.alimentos.almuerzos || [];
                    break;
                case 'comida':
                    alimentosArray = conditionData.alimentos.comidas || [];
                    break;
                case 'merienda':
                    alimentosArray = conditionData.alimentos.meriendas || [];
                    break;
                case 'cena':
                    alimentosArray = conditionData.alimentos.cenas || [];
                    break;
                default:
                    alimentosArray = [`${momento} espec√≠fico seg√∫n protocolo`];
            }
            
            if (alimentosArray.length === 0) {
                return `${momento} seg√∫n protocolo Redox`;
            }
            
            // Seleccionar alimento basado en d√≠a y fase para variedad
            const index = (dayIndex + (phase - 1) * 7 + (weekNumber - 1)) % alimentosArray.length;
            return alimentosArray[index];
        }

        function applyExclusions(alimento, exclusions) {
            let result = alimento;
            
            exclusions.forEach(exclusion => {
                switch(exclusion) {
                    case 'sin-huevos':
                        result = result.replace(/huevos?|tortilla|revuelto/gi, 'prote√≠na alternativa');
                        break;
                    case 'sin-lacteos':
                        result = result.replace(/mantequilla|k√©fir|queso|leche/gi, 'alternativa vegetal');
                        break;
                    case 'sin-frutos-secos':
                        result = result.replace(/nueces|almendras|avellanas/gi, 'semillas');
                        break;
                    case 'sin-gluten':
                        result = result.replace(/avena|pan|trigo/gi, 'alternativa sin gluten');
                        break;
                }
            });
            
            return result;
        }

        function adaptForSecondaryConditions(alimento, secondaryConditions, momento) {
            let adaptedAlimento = alimento;
            
            secondaryConditions.forEach(condition => {
                switch(condition) {
                    case 'fatiga-cronica':
                        if (momento === 'DESAYUNO') {
                            adaptedAlimento += " + Espinacas (hierro natural)";
                        }
                        break;
                    case 'caida-cabello':
                        if (momento === 'COMIDA') {
                            adaptedAlimento += " + Semillas calabaza (zinc)";
                        }
                        break;
                    case 'problemas-sue√±o':
                        if (momento === 'CENA') {
                            adaptedAlimento += " + Manzanilla";
                        }
                        break;
                    case 'problemas-piel':
                        if (momento === 'COMIDA') {
                            adaptedAlimento += " + Omega-3 extra";
                        }
                        break;
                    case 'ansiedad-estres':
                        if (momento === 'MERIENDA') {
                            adaptedAlimento += " + Magnesio natural";
                        }
                        break;
                    case 'problemas-digestivos':
                        if (momento === 'DESPERTAR') {
                            adaptedAlimento += " + Probi√≥ticos";
                        }
                        break;
                }
            });
            
            return adaptedAlimento;
        }

        function displayPlan(plan) {
            const preview = document.getElementById('menuPreview');
            let html = '';
            
            if (plan.tipo === 'semanal') {
                html = displayWeeklyPlan(plan);
            } else {
                html = displayEvolutionaryPlan(plan);
            }
            
            preview.innerHTML = html;
        }

        function displayWeeklyPlan(plan) {
            let html = `
                <h3>üìã Men√∫ Semanal Redox para: ${plan.paciente}</h3>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin: 20px 0;">
                    <p><strong>üéØ Condici√≥n:</strong> ${plan.condicion}</p>
                    <p><strong>üìã Protocolo:</strong> ${plan.protocolo}</p>
                    ${plan.terapias.length > 0 ? `<p><strong>‚öïÔ∏è Terapias:</strong> ${plan.terapias.join(', ')}</p>` : ''}
                    ${plan.exclusiones.length > 0 ? `<p><strong>üö´ Exclusiones:</strong> ${plan.exclusiones.join(', ')}</p>` : ''}
                </div>
                
                <table class="menu-table">
                    <thead>
                        <tr>
                            <th style="width: 120px;">Horario</th>
                            <th>LUNES</th>
                            <th>MARTES</th>
                            <th>MI√âRCOLES</th>
                            <th>JUEVES</th>
                            <th>VIERNES</th>
                            <th>S√ÅBADO</th>
                            <th>DOMINGO</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Obtener todos los momentos √∫nicos
            const momentos = [...new Set(plan.menu.flatMap(dia => dia.comidas.map(c => c.momento)))];
            
            momentos.forEach(momento => {
                html += `<tr>`;
                
                // Obtener horario del primer d√≠a que tenga este momento
                const horario = plan.menu.find(dia => 
                    dia.comidas.some(c => c.momento === momento)
                )?.comidas.find(c => c.momento === momento)?.horario || '';
                
                html += `<td class="meal-label">${momento}<br><small style="font-weight: normal; font-size: 0.8em;">${horario}</small></td>`;
                
                plan.menu.forEach(dia => {
                    const comida = dia.comidas.find(c => c.momento === momento);
                    html += `<td>${comida ? comida.alimento : '-'}</td>`;
                });
                
                html += `</tr>`;
            });
            
            html += `
                    </tbody>
                </table>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin-top: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">üìù Notas Importantes</h4>
                    <ul style="margin-left: 20px; color: #6c757d;">
                        <li>Seguir horarios de forma estricta para optimizar ritmos circadianos</li>
                        <li>Hidrataci√≥n: m√≠nimo 2.5-3L diarios distribuidos entre comidas</li>
                        <li>Masticaci√≥n consciente: m√≠nimo 20-30 masticaciones por bocado</li>
                        <li>Evaluaci√≥n semanal de s√≠ntomas y ajustes seg√∫n respuesta</li>
                        ${plan.terapias.includes('infrarrojo') ? '<li>Terapia infrarroja: diaria 20-30 min, preferentemente post-comida</li>' : ''}
                        ${plan.terapias.includes('termogenesis') ? '<li>Termog√©nesis: 3 sesiones semanales, progresi√≥n gradual</li>' : ''}
                    </ul>
                </div>
            `;
            
            return html;
        }

        function displayEvolutionaryPlan(plan) {
            let html = `
                <h3>üîÑ Plan Evolutivo Redox para: ${plan.paciente}</h3>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin: 20px 0;">
                    <p><strong>üéØ Condici√≥n:</strong> ${plan.condicion}</p>
                    <p><strong>‚è±Ô∏è Duraci√≥n:</strong> ${plan.duracion} semanas</p>
                    <p><strong>üìã Protocolo Base:</strong> ${plan.protocolo}</p>
                    ${plan.terapias.length > 0 ? `<p><strong>‚öïÔ∏è Terapias:</strong> ${plan.terapias.join(', ')}</p>` : ''}
                    ${plan.exclusiones.length > 0 ? `<p><strong>üö´ Exclusiones:</strong> ${plan.exclusiones.join(', ')}</p>` : ''}
                </div>
            `;
            
            plan.fases.forEach(fase => {
                html += `
                    <div class="phase-card">
                        <div class="phase-header">
                            <div class="phase-number">${fase.numero}</div>
                            <div class="phase-title">
                                <h4>FASE ${fase.numero}: ${fase.nombre.toUpperCase()}</h4>
                                <p>Semanas ${fase.semanas.join(', ')} ‚Ä¢ ${fase.objetivo}</p>
                            </div>
                        </div>
                `;
                
                fase.menus.forEach(menuSemana => {
                    html += `
                        <div class="week-menu">
                            <div class="week-title">üìÖ SEMANA ${menuSemana.semana}</div>
                            <table class="menu-table" style="margin: 10px 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;">Momento</th>
                                        <th>LUN</th><th>MAR</th><th>MI√â</th><th>JUE</th><th>VIE</th><th>S√ÅB</th><th>DOM</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    // Obtener momentos √∫nicos para esta semana
                    const momentos = [...new Set(menuSemana.menu.flatMap(dia => dia.comidas.map(c => c.momento)))];
                    
                    momentos.forEach(momento => {
                        html += `<tr>`;
                        html += `<td class="meal-label" style="font-size: 0.75em; padding: 5px;">${momento}</td>`;
                        
                        menuSemana.menu.forEach(dia => {
                            const comida = dia.comidas.find(c => c.momento === momento);
                            html += `<td style="font-size: 0.75em; padding: 5px;">${comida ? comida.alimento.substring(0, 50) + '...' : '-'}</td>`;
                        });
                        
                        html += `</tr>`;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
            
            html += `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin-top: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üéØ Cronograma de Objetivos</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            `;
            
            plan.fases.forEach(fase => {
                html += `
                    <div style="background: white; padding: 15px; border-radius: 6px; border-left: 4px solid #3498db;">
                        <h5 style="color: #2c3e50; margin-bottom: 5px;">Fase ${fase.numero}: ${fase.nombre}</h5>
                        <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 5px;">Semanas ${fase.semanas.join('-')}</p>
                        <p style="font-size: 0.85em; color: #495057;">${fase.objetivo}</p>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }

        function goBack() {
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('formSection').style.display = 'block';
        }

        function downloadPDF() {
            if (!menuGenerado) {
                alert('No hay men√∫ generado para descargar');
                return;
            }
            
            // Crear contenido HTML para impresi√≥n
            const printContent = document.getElementById('menuPreview').innerHTML;
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Plan Redox - ${menuGenerado.paciente}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #2c3e50; }
                        .menu-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        .menu-table th, .menu-table td { border: 1px solid #ddd; padding: 8px; font-size: 0.8em; }
                        .menu-table th { background: #f8f9fa; font-weight: bold; }
                        .meal-label { background: #f8f9fa; font-weight: bold; }
                        .phase-card { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
                        .week-menu { margin: 15px 0; padding: 10px; background: #f8f9fa; }
                        h3, h4 { color: #2c3e50; }
                        @media print { body { margin: 10px; font-size: 12px; } }
                    </style>
                </head>
                <body>
                    <h1>üå± Plan Nutricional Redox</h1>
                    <p><strong>Generado el:</strong> ${new Date().toLocaleDateString('es-ES')}</p>
                    <p><strong>Dietaryplus - Filosof√≠a Redox</strong></p>
                    <hr>
                    ${printContent}
                    <hr>
                    <p style="text-align: center; color: #6c757d; font-size: 0.9em;">
                        ¬© Dietaryplus - www.dietaryplus.com<br>
                        Plan generado con Metodolog√≠a Redox
                    </p>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        // Test b√°sico para verificar funcionamiento
		
        function testFunction() {
            console.log('JavaScript funcionando correctamente');
        }
        
        console.log('Script cargado correctamente - Versi√≥n completa');
    </script>
</body>
</html>
